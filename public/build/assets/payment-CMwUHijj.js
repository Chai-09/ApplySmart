document.addEventListener("DOMContentLoaded",function(){let t=null,i=null;window.viewProof=function(e){e.toLowerCase().endsWith(".pdf")?window.open(e,"_blank"):Swal.fire({title:"Proof of Payment",imageUrl:e,imageAlt:"Proof of Payment",width:600,confirmButtonText:"Close"})},window.viewInfo=function(e){const n=document.getElementById("updateForm"),o=n.cloneNode(!0);n.replaceWith(o),document.getElementById("idNumber").innerText=e.id||"N/A",document.getElementById("applicantName").innerText=`${e.applicant_fname} ${e.applicant_mname} ${e.applicant_lname}`,document.getElementById("gradeLevel").innerText=`${e.incoming_grlvl} ${e.incoming_strand||""}`.trim(),document.getElementById("contactNumber").innerText=e.applicant_contact_number,document.getElementById("guardianName").innerText=e.guardian_name||"N/A",document.getElementById("paymentTime").innerText=new Date(e.created_at).toLocaleString(),document.getElementById("paymentMethod").innerText=e.payment_method;const d=document.getElementById("proofContainer"),m=`/storage/${e.proof_of_payment}`,r=m.toLowerCase().endsWith(".pdf");d.innerHTML=r?`<iframe src="${m}" width="100%" height="400px" style="border: none;"></iframe>`:`<img src="${m}" alt="Proof of Payment" class="img-fluid rounded shadow" style="max-height: 400px;">`,document.getElementById("acceptStatus").checked=e.payment_status==="approved",document.getElementById("denyStatus").checked=e.payment_status==="denied",document.getElementById("remarks").value=e.remarks||"",document.getElementById("ocr_number").value=e.ocr_number||"",document.getElementById("acceptStatus").addEventListener("change",c),document.getElementById("denyStatus").addEventListener("change",c),c(),document.getElementById("paymentId").value=e.id,o.action=`/accountant/payment-decision/${e.id}`,o.addEventListener("submit",function(l){t&&t.getQueuedFiles().length>0&&(l.preventDefault(),t.processQueue())}),new bootstrap.Modal(document.getElementById("infoModal")).show()};function c(){var o;const e=(o=document.getElementById("acceptStatus"))==null?void 0:o.checked,n=document.getElementById("approvedFields");if(n){if(n.style.display=e?"block":"none",e)t||(t=new Dropzone("#receiptDropzone",{url:window.uploadReceiptUrl,autoProcessQueue:!1,maxFiles:1,acceptedFiles:"image/*,.pdf",addRemoveLinks:!0,dictRemoveFile:"Remove",headers:{"X-CSRF-TOKEN":window.csrfToken},success:function(d,m){i=m.file_path,document.getElementById("receipt").value=i,document.getElementById("updateForm").submit()},removedfile:function(d){i&&(fetch(window.deleteReceiptUrl,{method:"POST",headers:{"X-CSRF-TOKEN":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({file_path:i})}),i=null,document.getElementById("receipt").value=""),d.previewElement.remove()}}));else if(document.getElementById("ocr_number").value="",document.getElementById("receipt").value="",t)try{t.removeAllFiles(!0),t.destroy(),t=null,document.getElementById("receiptDropzone").innerHTML=""}catch(d){console.warn("Dropzone destroy failed:",d)}}}});
