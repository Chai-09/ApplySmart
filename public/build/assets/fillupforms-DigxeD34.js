document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("educational_level"),t=document.getElementById("incoming_grlvl"),r=document.getElementById("strand-container"),e=document.getElementById("birthday-container"),n=document.getElementById("lrn-container"),l=document.getElementById("source-container"),s=document.getElementById("grade-level-container"),a={"Grade School":["Kinder","Grade 1","Grade 2","Grade 3","Grade 4","Grade 5","Grade 6"],"Junior High School":["Grade 7","Grade 8","Grade 9","Grade 10"],"Senior High School":["Grade 11","Grade 12"]},i=t.getAttribute("data-selected")||t.value;function m(c){t.innerHTML='<option value="">Select Grade Level</option>',a[c]&&a[c].forEach(d=>{const p=document.createElement("option");p.value=d,p.textContent=d,i&&i===d&&(p.selected=!0),t.appendChild(p)})}function u(){const c=o.value,d=t.value;s.style.display="block",l.style.display="block",r.style.display="none",e.style.display="none",n.style.display="none",c==="Grade School"?(n.style.display="block",(d==="Kinder"||d==="Grade 1")&&(e.style.display="block")):c==="Junior High School"?n.style.display="block":c==="Senior High School"&&(n.style.display="block",r.style.display="block")}o.addEventListener("change",function(){const c=this.value;m(c),u()}),t.addEventListener("change",function(){u()}),u()});function y(o){const t=document.getElementById("alert-container"),r=document.getElementById("alert-wrapper"),e=document.querySelector(".alert-box");e&&e.remove();const n=document.createElement("div");n.classList.add("alert-box"),n.innerHTML=`
        <div class="alert-content">
            <div class="alert-message">
                <span><i class="fa-solid fa-circle-exclamation"></i> ${o}</span>
            </div>
            <span class="alert-close" onclick="this.parentElement.parentElement.remove()">&times;</span>
        </div>
    `,r.style.display="block",t.style.display="block",t.appendChild(n)}window.nextStep=function(o){if(o>1){const r=document.querySelectorAll(`#step${o-1} [required]`);let e=!0;if(r.forEach(n=>{const l=n.value.trim(),s=n.getAttribute("type");if(!l){e=!1,n.classList.add("border-danger"),y("Please complete all required fields.");return}if(s==="email"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){e=!1,n.classList.add("border-danger"),y("Please enter a valid email address (e.g., name@example.com).");return}if(s==="tel"&&!/^09\d{9}$/.test(l)){e=!1,n.classList.add("border-danger"),y("Please enter a valid phone number starting with 09 followed by 9 digits.");return}if(s==="number"&&(isNaN(l)||l<0)){e=!1,n.classList.add("border-danger"),y("Please enter a valid numeric value.");return}n.classList.remove("border-danger")}),!e)return}document.querySelectorAll("#step1, #step2, #step3").forEach(r=>{r.style.display="none"}),document.getElementById("step"+o).style.display="block";const t=document.querySelector(".alert-box");t&&t.remove(),document.querySelectorAll("input, select").forEach(r=>{r.classList.remove("border-danger")})};document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("current_school_city"),t=document.getElementById("citySuggestions");if(!o||!t)return;let r=[];fetch("https://psgc.gitlab.io/api/provinces/").then(e=>e.json()).then(e=>{r=e}).catch(e=>console.error("Failed to load provinces:",e)),o.addEventListener("input",async function(){const e=o.value.trim().toLowerCase();if(t.innerHTML="",!(e.length<2))try{const l=await(await fetch("https://psgc.gitlab.io/api/cities-municipalities/")).json(),s=[];for(const a of l)if(a.name.toLowerCase().includes(e)){let i="Unknown Province";if(!a.provinceCode)i="Metro Manila";else{const m=r.find(u=>u.code===a.provinceCode);m&&(i=m.name)}s.push(`${a.name}, ${i}`)}s.length===0?t.innerHTML='<li class="list-group-item disabled">No results found</li>':s.forEach(a=>{const i=document.createElement("li");i.classList.add("list-group-item"),i.textContent=a,i.style.cursor="pointer",i.onclick=()=>{o.value=a,t.innerHTML=""},t.appendChild(i)})}catch(n){console.error("City fetch error:",n)}}),document.addEventListener("click",e=>{!t.contains(e.target)&&e.target!==o&&(t.innerHTML="")})});
