document.addEventListener("DOMContentLoaded",function(){let n=null,d=null;window.viewProof=function(e){e.toLowerCase().endsWith(".pdf")?window.open(e,"_blank"):Swal.fire({title:"Proof of Payment",imageUrl:e,imageAlt:"Proof of Payment",width:600,confirmButtonText:"Close"})},window.viewInfo=function(e){const t=document.getElementById("updateForm"),o=t.cloneNode(!0);t.replaceWith(o),document.getElementById("idNumber").innerText=e.id||"N/A",document.getElementById("applicantName").innerText=`${e.applicant_fname} ${e.applicant_mname} ${e.applicant_lname}`,document.getElementById("gradeLevel").innerText=`${e.incoming_grlvl} ${e.incoming_strand||""}`.trim(),document.getElementById("contactNumber").innerText=e.applicant_contact_number,document.getElementById("guardianName").innerText=`${e.guardian_fname} ${e.guardian_mname?e.guardian_mname+".":""} ${e.guardian_lname}`.trim(),document.getElementById("paymentTime").innerText=new Date(e.created_at).toLocaleString(),document.getElementById("paymentMethod").innerText=e.payment_method;const i=document.getElementById("proofContainer"),m=`/storage/${e.proof_of_payment}`,c=m.toLowerCase().endsWith(".pdf");i.innerHTML=c?`<iframe src="${m}" width="100%" height="400px" style="border: none;"></iframe>`:`<img src="${m}" alt="Proof of Payment" class="img-fluid rounded shadow" style="max-height: 400px;">`,document.getElementById("acceptStatus").checked=e.payment_status==="approved",document.getElementById("denyStatus").checked=e.payment_status==="denied",document.getElementById("remarks").value=e.remarks||"",document.getElementById("ocr_number").value=e.ocr_number||"",document.getElementById("acceptStatus").addEventListener("change",r),document.getElementById("denyStatus").addEventListener("change",r),r(),document.getElementById("paymentId").value=e.id,o.action=`/accountant/payment-decision/${e.id}`,o.addEventListener("submit",function(l){n&&n.getQueuedFiles().length>0&&(l.preventDefault(),n.processQueue())}),new bootstrap.Modal(document.getElementById("infoModal")).show()};function r(){var o;const e=(o=document.getElementById("acceptStatus"))==null?void 0:o.checked,t=document.getElementById("approvedFields");if(t){if(t.style.display=e?"block":"none",e)n||(n=new Dropzone("#receiptDropzone",{url:window.uploadReceiptUrl,autoProcessQueue:!1,maxFiles:1,acceptedFiles:"image/*,.pdf",addRemoveLinks:!0,dictRemoveFile:"Remove",headers:{"X-CSRF-TOKEN":window.csrfToken},success:function(i,m){d=m.file_path,document.getElementById("receipt").value=d,document.getElementById("updateForm").submit()},removedfile:function(i){d&&(fetch(window.deleteReceiptUrl,{method:"POST",headers:{"X-CSRF-TOKEN":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({file_path:d})}),d=null,document.getElementById("receipt").value=""),i.previewElement.remove()}}));else if(document.getElementById("ocr_number").value="",document.getElementById("receipt").value="",n)try{n.removeAllFiles(!0),n.destroy(),n=null,document.getElementById("receiptDropzone").innerHTML=""}catch(i){console.warn("Dropzone destroy failed:",i)}}}});
