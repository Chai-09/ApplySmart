document.addEventListener("DOMContentLoaded",function(){let t=null,i=null;window.viewProof=function(e){e.toLowerCase().endsWith(".pdf")?window.open(e,"_blank"):Swal.fire({title:"Proof of Payment",imageUrl:e,imageAlt:"Proof of Payment",width:450,padding:"1em",confirmButtonText:"Close"})};let l="";window.viewProofFromModal=function(){l?viewProof(l):Swal.fire({icon:"info",title:"No receipt uploaded",text:"This applicant did not submit a proof of payment."})},window.viewInfo=function(e){const n=document.getElementById("updateForm"),o=n.cloneNode(!0);n.replaceWith(o),document.getElementById("idNumber").innerText=e.id||"N/A",document.getElementById("applicantName").innerText=`${e.applicant_fname} ${e.applicant_mname} ${e.applicant_lname}`,document.getElementById("gradeLevel").innerText=`${e.incoming_grlvl} ${e.incoming_strand||""}`.trim(),document.getElementById("contactNumber").innerText=e.applicant_contact_number,document.getElementById("guardianName").innerText=`${e.guardian_fname} ${e.guardian_mname?e.guardian_mname+".":""} ${e.guardian_lname}`.trim(),document.getElementById("paymentTime").innerText=new Date(e.created_at).toLocaleString(),document.getElementById("paymentMethod").innerText=e.payment_method,document.getElementById("paymentType").innerText=e.payment_for?e.payment_for==="resched"?"Reschedule":"First-Time":"N/A",document.getElementById("proofContainer"),l=`/storage/${e.proof_of_payment}`,document.getElementById("acceptStatus").checked=e.payment_status==="approved",document.getElementById("denyStatus").checked=e.payment_status==="denied",document.getElementById("remarks").value=e.remarks||"",document.getElementById("ocr_number").value=e.ocr_number||"",document.getElementById("acceptStatus").addEventListener("change",m),document.getElementById("denyStatus").addEventListener("change",m),m(),document.getElementById("paymentId").value=e.id,o.action=`/accountant/payment-decision/${e.id}`,o.addEventListener("submit",function(d){var c;if((c=document.getElementById("acceptStatus"))==null?void 0:c.checked){const a=document.getElementById("ocr_number").value.trim(),u=t?t.getAcceptedFiles():[],s=u.length>0;if(!a||!s){d.preventDefault(),Swal.fire({icon:"warning",title:"Missing Required Fields",text:"Please upload a receipt and enter the OCR number before submitting."});return}if(u[0].size>2*1024*1024){d.preventDefault(),Swal.fire({icon:"error",title:"File Too Large",text:"The uploaded receipt must be 2MB or less."});return}t.getQueuedFiles().length>0&&(d.preventDefault(),t.processQueue())}}),new bootstrap.Modal(document.getElementById("infoModal")).show()};function m(){var o;const e=(o=document.getElementById("acceptStatus"))==null?void 0:o.checked,n=document.getElementById("approvedFields");if(n){if(n.style.display=e?"block":"none",e)t||(t=new Dropzone("#receiptDropzone",{url:window.uploadReceiptUrl,autoProcessQueue:!1,maxFiles:1,acceptedFiles:"image/*,.pdf",addRemoveLinks:!0,dictRemoveFile:"Remove",headers:{"X-CSRF-TOKEN":window.csrfToken},success:function(r,d){i=d.file_path,document.getElementById("receipt").value=i,document.getElementById("updateForm").submit()},removedfile:function(r){i&&(fetch(window.deleteReceiptUrl,{method:"POST",headers:{"X-CSRF-TOKEN":window.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({file_path:i})}),i=null,document.getElementById("receipt").value=""),r.previewElement.remove()}}));else if(document.getElementById("ocr_number").value="",document.getElementById("receipt").value="",t)try{t.removeAllFiles(!0),t.destroy(),t=null,document.getElementById("receiptDropzone").innerHTML=""}catch(r){console.warn("Dropzone destroy failed:",r)}}}});
