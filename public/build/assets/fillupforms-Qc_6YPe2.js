document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("educational_level"),t=document.getElementById("incoming_grlvl"),l=document.getElementById("strand-container"),e=document.getElementById("birthday-container"),n=document.getElementById("lrn-container"),a=document.getElementById("source-container"),i=document.getElementById("grade-level-container"),r={"Grade School":["Kinder","Grade 1","Grade 2","Grade 3","Grade 4","Grade 5","Grade 6"],"Junior High School":["Grade 7","Grade 8","Grade 9","Grade 10"],"Senior High School":["Grade 11","Grade 12"]},s=t.getAttribute("data-selected")||t.value;function p(c){t.innerHTML='<option value="">Select Grade Level</option>',r[c]&&r[c].forEach(d=>{const y=document.createElement("option");y.value=d,y.textContent=d,s&&s===d&&(y.selected=!0),t.appendChild(y)})}function u(){const c=o.value,d=t.value;i.style.display="none",a.style.display="none",l.style.display="none",e.style.display="none",n.style.display="none",c==="Grade School"?(n.style.display="block",i.style.display="block",a.style.display="block",(d==="Kinder"||d==="Grade 1")&&(e.style.display="block",i.style.display="block",a.style.display="block")):c==="Junior High School"?(n.style.display="block",i.style.display="block",a.style.display="block"):c==="Senior High School"&&(n.style.display="block",l.style.display="block",i.style.display="block",a.style.display="block")}o.addEventListener("change",function(){const c=this.value;p(c),u()}),t.addEventListener("change",function(){u()}),u()});function m(o){const t=document.getElementById("alert-container"),l=document.getElementById("alert-wrapper"),e=document.querySelector(".alert-box");e&&e.remove();const n=document.createElement("div");n.classList.add("alert-box"),n.innerHTML=`
        <div class="alert-content">
            <div class="alert-message">
                <span><i class="fa-solid fa-circle-exclamation"></i> ${o}</span>
            </div>
            <span class="alert-close" onclick="this.parentElement.parentElement.remove()">&times;</span>
        </div>
    `,l.style.display="block",t.style.display="block",t.appendChild(n)}window.nextStep=function(o){if(o>1){const l=document.querySelectorAll(`#step${o-1} [required]`);let e=!0;if(l.forEach(n=>{const a=n.value.trim(),i=n.getAttribute("type");if(!a){e=!1,n.classList.add("border-danger"),m("Please complete all required fields.");return}if(i==="email"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){e=!1,n.classList.add("border-danger"),m("Please enter a valid email address (e.g., name@example.com).");return}if(i==="tel"&&!/^09\d{9}$/.test(a)){e=!1,n.classList.add("border-danger"),m("Please enter a valid phone number starting with 09 followed by 9 digits.");return}if(i==="number"&&(isNaN(a)||a<0)){e=!1,n.classList.add("border-danger"),m("Please enter a valid numeric value.");return}n.classList.remove("border-danger")}),!e)return}document.querySelectorAll("#step1, #step2, #step3").forEach(l=>{l.style.display="none"}),document.getElementById("step"+o).style.display="block";const t=document.querySelector(".alert-box");t&&t.remove(),document.querySelectorAll("input, select").forEach(l=>{l.classList.remove("border-danger")})};document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("current_school_city"),t=document.getElementById("citySuggestions");if(!o||!t)return;let l=[];fetch("https://psgc.gitlab.io/api/provinces/").then(e=>e.json()).then(e=>{l=e}).catch(e=>console.error("Failed to load provinces:",e)),o.addEventListener("input",async function(){const e=o.value.trim().toLowerCase();if(t.innerHTML="",!(e.length<2))try{const a=await(await fetch("https://psgc.gitlab.io/api/cities-municipalities/")).json(),i=[];for(const r of a)if(r.name.toLowerCase().includes(e)){let s="Unknown Province";if(!r.provinceCode)s="Metro Manila";else{const p=l.find(u=>u.code===r.provinceCode);p&&(s=p.name)}i.push(`${r.name}, ${s}`)}i.length===0?t.innerHTML='<li class="list-group-item disabled">No results found</li>':i.forEach(r=>{const s=document.createElement("li");s.classList.add("list-group-item"),s.textContent=r,s.style.cursor="pointer",s.onclick=()=>{o.value=r,t.innerHTML=""},t.appendChild(s)})}catch(n){console.error("City fetch error:",n)}}),document.addEventListener("click",e=>{!t.contains(e.target)&&e.target!==o&&(t.innerHTML="")})});
